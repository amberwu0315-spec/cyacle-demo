# ğŸ›‘ Common Mistakes & Pre-Flight Checklist (ç»éªŒå¤ç›˜ä¸é¿å‘æŒ‡å—)

> **Purpose:** actively track past implementation errors to prevent recurrence. 
> **Usage:** Review this document BEFORE applying complex logic changes or refactoring.

## 1. âš ï¸ Logic & Control Flow Errors (é€»è¾‘æ§åˆ¶é”™è¯¯)

### [Critical] Empty/Duplicate Logic Blocks (ç©ºé€»è¾‘å—é®è”½)
*   **Incident:** `Workbench.jsx` Header Logic Refactor (2026-02-04)
*   **Problem:** An empty `else if (condition) {}` block was left above the *real* logic block. The empty block captured the condition, causing the real code to be unreachable.
*   **Prevention Rule:** 
    *   **NEVER** leave empty `if/else` blocks "for future use".
    *   **ALWAYS** verify the *structure* of the code surrounding the edit target, not just the lines being replaced.
    *   **USE** `view_file` to inspect the full context if `multi_replace` fails or behavior is unexpected.

### [High] Variable Shadowing (å˜é‡é®è”½)
*   **Incident:** `Workbench.jsx` Header Logic Refactor (2026-02-04)
*   **Problem:** Redeclared `titleMap` inside a second `if` block within the same scope (or effectively confusing the scope), causing TypeScript errors and logic ambiguity.
*   **Prevention Rule:** 
    *   **Use Specific Names**: Instead of generic `titleMap`, use `projectTitleMap`, `businessTitleMap`, `entTitleMap`.
    *   **Check Scope**: Be aware of variables declared in the upper scope of the function/hook.

## 2. ğŸ§  Business Logic Misalignments (ä¸šåŠ¡é€»è¾‘åå·®)

### [High] Context vs. Label Mismatch (è¯­å¢ƒé”™ä½)
*   **Incident:** L1 Header Titles (2026-02-04)
*   **Problem:** Displaying the "Room Name" (e.g., "Project Management") instead of the "Activity Name" (e.g., "All Projects").
*   **Prevention Rule:**
    *   **The "Context Rule"**: The Page Header must answer "What am I doing right now?", not "Where is this link located?".
    *   **Default States**: Ensure the Default State (entering a module) matches the Default Content Title.

## 3. ğŸ—ï¸ Architecture & Documentation (æ¶æ„ä¸æ–‡æ¡£)

### [Critical] Authority of Documentation (æ–‡æ¡£è£åˆ¤æƒ)
*   **Lesson:** `PROJECT_RULES.md` is the Constitution; `design_system.md` is the Law.
*   **Rule:** **Never redefine rules.** If a style in `design_system` conflicts with a principle in `PROJECT_RULES`, `PROJECT_RULES` wins. Do not "invent" new rules in code to patch conflicts.

### [High] Layout Consistency (å¸ƒå±€ç»Ÿä¸€æ€§)
*   **Incident:** Enterprise Detail View Layout Mismatch.
*   **Lesson:** Do not build "Special Layouts" for specific entities (e.g., Enterprise).
*   **Rule:** **Reuse Standard Layouts.** All Detail Views (Tabs) MUST use the standard `ProjectLayout` structure (Sidebar + Content). Inject content via Context/Props, do not rebuild the frame.

## 4. ğŸ’» Code Quality & Patterns (ä»£ç è´¨é‡ä¸æ¨¡å¼)

### [High] Refactor > Copy-Paste (ç»„ä»¶å¤ç”¨åŸåˆ™)
*   **Incident:** `BusinessSidebar` vs `L2Sidebar` (2026-02-04).
*   **Lesson:** Creating "Twin Components" for similar views leads to double maintenance (e.g., fixing collapse logic twice).
*   **Rule:** **Extend, Don't Duplicate.** If a component is 80% similar, add a `mode` or `config` prop to handle the 20% difference.

## 5. ğŸ¨ UI/UX Precision (äº¤äº’ç²¾ç¡®æ€§)

### [Medium] Visual State Precision (è§†è§‰çŠ¶æ€å…¨é›†)
*   **Incident:** Checkbox Checked+Disabled State.
*   **Lesson:** UI is not just "Enabled/Disabled". Business logic often requires "Mandatory Active" (Checked + Disabled).
*   **Rule:** **Enumerate States.** Implement the full matrix of states (Checked/Unchecked x Enabled/Disabled) from the start.

### [High] Functional Context First (åŠŸèƒ½è¯­å¢ƒä¼˜å…ˆ)
*   **Incident:** Header Title Mismatch (Project Tag vs All Projects).
*   **Lesson:** Users care about "What I am doing" (Activity), not "Where I am" (Room).
*   **Rule:** **Header = Activity.** The Page Header must always match the *default inner content* title. (e.g., Entering "Project Mgmt" -> Header must be "All Projects", NOT "Project Management").

## 6. ğŸ› ï¸ Tooling & Verification (å·¥å…·ä¸éªŒè¯)

### [Medium] Verification Laziness (éªŒè¯æƒ°æ€§)
*   **Incident:** Premature confirmation of fixes.
*   **Problem:** Assuming a fix worked because the tool call didn't error, without verifying the *runtime logic* path.
*   **Prevention Rule:**
    *   **Trace the Path**: mentally walk through: "If input is X, does it hit Block A or Block B?".
    *   **Full File Read**: After a messy series of edits, perform one full `view_file` to ensure structural integrity.

---

## ğŸš€ Pre-Flight Checklist (Before Complex Edits)

1.  [ ] **Context Check**: Do I see the 10 lines *before* and *after* my target edit?
2.  [ ] **Shadow Check**: Am I reusing a variable name (`config`, `map`, `data`) that already exists?
3.  [ ] **Logic Check**: Did I delete the old logic block, or did I just append new logic *after* it?
4.  [ ] **User Rule Check**: Does this change violate a "Fixed Rule" (e.g., Header = Context)?

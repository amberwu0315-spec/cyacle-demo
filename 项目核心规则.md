# CYACLE PROJECT RULES (项目铁律)

> **⚠️ CRITICAL (警告)**: 
> 本文件是项目的**唯一真理源 (Single Source of Truth)**。
> 所有 AI 助手在进行修改前，必须优先遵守本文件。
> 原 `container_logic.md` 已被废弃并合并至此。

## 1. 页面布局 (Page Layout)

### 🔵 顶部栏规则 (Header Rules)

#### L2二级页面差异化规则 (L2 Header Differentiation)

并非所有二级页面都相同。请严格遵守以下模块区分：

**A. 简单模式 (Simple L2)**  
**适用模块**: 
所有标准 L2 列表页面（非核算类）。

**标题显示规则 (Title Display Rules)**:
系统存在三种标题显示模式，具体应用由各模块的业务属性决定：

1.  **Context Mode (上下文模式)**:
    *   **定义**: 标题显示当前**业务上下文的名称**（即用户当前所处的“空间”名称）。
    *   **适用场景**: 承载项目级或组织级整体属性的页面，强调“我在哪里”而非“我在用什么功能”。

2.  **Functional Mode (功能模式)**:
    *   **定义**: 标题显示当前**系统菜单或功能模块的静态名称**。
    *   **适用场景**: 具体的业务工具、数据列表或管理面板，强调“我在使用什么工具”。

3.  **Detail Mode (详情模式)**:
    *   **定义**: 标题显示当前**选中数据实体的具体名称**。
    *   **适用场景**: 所有的详情页 Tab、编辑页。

**组件配置**: 
*   **左侧**: `Title` (根据上述模式显示).
*   **右侧**: `Business Actions`.
    *   **规则**: 业务按钮（如创建、AI生成）的具体内容由各页面(Page)逻辑自行定义，必须通过 `useHeaderContext` 注入。
*   **禁止**: 禁止出现面包屑、方法学、模式切换。

**⚠️ 背景数据类特殊铁律 (Background Data Specials)**:
1.  **动作归位**: "创建/添加"等页面级核心操作按钮**严禁**放置在内容区，必须通过 `useHeaderContext` 注入到 Header 右侧区域。
2.  **全宽布局**: 内容区域必须使用 `w-full` 撑满容器，严禁在右侧预留非必要的空白区域。布局顺序统一为：Header > (Search) > Filter > Table。

**B. 复杂模式 (Complex L2 - Multi-View Analysis)**  
**适用模块**: 具有多维视图切换和复杂层级导航的分析型模块（如核算）。
**Header 构造规则**:
此类模块**允许接管**顶部栏的渲染逻辑，以容纳更复杂的操作流：
1.  **导航增强**: 必须提供面包屑或层级指示器，明确用户在多维数据中的位置。
2.  **工具栏扩展**: 允许在右侧区域嵌入模块专属的“工具栏组件” (Toolbar Widgets)，如方法学选择器、模式切换器等。
3.  **视图操作**: 必须保留标准的视图控制能力 (Divider + View Actions)。

*(具体组件实现请参考 `design_system.md`)*

---

### 🗂️ 标签页与详情视图 (Tabs & Detail Views)

### 🗂️ 标签页与详情视图 (Tabs & Detail Views)

#### 标签页定位 (Tab Location)
*   **架构原则**: 标签页 (Tabs) 属于**全局导航 (L1)** 范畴。
*   **位置约束**: 必须渲染在 **L1全局侧边栏** 区域内。严禁侵入业务侧边栏或顶部栏。
*   **状态持久化**: 切换 L1 上下文时，标签页状态应当保留。

#### 详情页视图统一 (Detail View Unification)
*   **布局一致性**: 所有详情页（Detail Views）本质上都是标准项目视图的**变体**。
*   **渲染规则**: 打开详情页时，必须完整加载**标准项目布局 (Standard Project Layout)**：
    *   **L2 Sidebar**: 显示标准项目菜单配置。
    *   **Main Content**: 渲染核心业务布局组件。
*   **上下文映射**: 点击标签时，系统应自动路由至该标签对应的**上下文环境** (Context)。

---

### 🦶 Footer Modal 规则 (Footer Modal Rules)

#### 架构定位 (Architectural Position)
Footer Modal 是一种**非阻塞式、上下文相关**的辅助操作层。

**⚠️ 定位铁律**:
*   **层级**: 必须覆盖**主内容区 (Main Content)** 和 **L3 侧边栏**。
*   **避让**: 必须**避让** L1 全局导航、L2 业务导航和 Footer 底部栏。这创造出“抽屉从底部栏延伸出来”的视觉隐喻。
*   **容器相对性**: 必须相对于**右侧工作区容器 (Right Zone)** 进行绝对定位，而非全屏 Fixed 定位。

#### 交互原则 (Interaction Principles)
*   **Toggle 行为**: 点击底部栏按钮触发“开启/关闭”切换。
*   **排他性**: 同一时间只能打开一个 Footer Modal。
*   **上下文敏感**: 切换主要导航 (L1/L2) 时，Modal 应当自动关闭。

---

## 2. 视觉与交互铁律 (Visual & Interaction Core)

### 🎨 设计系统一致性 (Design System Compliance)
*   **单一来源**: 所有视觉样式（颜色、圆角、阴影）必须严格引用 `design_system.md` 中定义的 **Tokens**。
*   **禁止硬编码**: 严禁在代码中使用未定义的 Magic Numbers 或 HEX 色值。

### 📐 布局几何 (Layout Geometry)
*   **统一间距法则**: 整个系统的内容区域强制执行统一的间距标准（如 `12px` 体系）。所有的 Padding 和 Gap 必须基于此基准倍数。

### 🖱️ 交互模式 (Interaction Patterns)
*   **原位优先**: 属性编辑应优先采用**原位编辑 (Inline Editing)** 模式，避免过度的弹窗干扰。
*   **历史作用域**: 前进/后退等历史操作必须限定在**当前上下文 (Scoped History)** 内部，不可跨越项目边界。



## 3. 核心业务逻辑 (Core Business Logic)

### 🔄 全周期创建原则 (Closed-Loop Creation Principle)
*   **定义**: 任何“创建”流程（如创建项目、创建工厂、创建因子）必须形成**闭环**。
*   **铁律**:
    1.  **即时生成**: 提交创建后，必须立即在对应的**数据列表**中生成一条新的持久化记录。
    2.  **详情可达**: 系统必须提供即时的途径查看新实体的详情（例如：自动打开详情标签页、跳转至详情页、或在列表中高亮显示）。
    3.  **持久化**: 创建的数据必须能够抵抗视图切换（View Switching），严禁因组件卸载而丢失。

